# eleventy-plugin-jupyter-nb-extract

Eleventy plugin to extract cell sources and cell output from Jupyter notebooks
for use in markdown documents.

!!! This plugin is in development and supports only a small subset of Jupyters features !!!

This plugin does not aim to render complete notebooks, but to include code cell sources
and their outputs in a markdown document. The cells in the notebook have to be
labeled with a tag. The plugin uses the tag to find the desired cell and its
output.

Please read below what is currently supported.

**Warning**: Embedding unknown input in your Markdown can pose a security risk.
To be safe, only include code or outputs of notebooks from a trusted source.


## Installation

The plugin is not on npm, so you have to manually install it.
In your Eleventy project folder, create a directory for local plugins (e.g. `modules`).
Then clone the git repository into that folder.

``` bash
$ cd modules
$ git clone https://codeberg.org/vpratz/eleventy-plugin-jupyter-nb-extract.git
$ cd ..
```

Next, import the plugin in you `eleventy.config.js` file with

``` js
import pluginJupyter from "./modules/eleventy-plugin-jupyter-nb-extract/.eleventy.js";
```

and add it to your plugins with `eleventyConfig.addPlugin(pluginJupyter);`. If you
change your input directory, please add the plugin after changing it.

## Usage

First, create a notebook with the name `notebook.ipynb` next to the markdown document.
Write some code and use the Jupyter notebook
[tags](https://jupyterbook.org/en/stable/content/metadata.html#adding-tags-using-notebook-interfaces)
(available via the _Property Inspector_ in the top right of Jupyter labs)
to give the cells you want to include unique names.

You can now use the following shortcodes to include source code, image output,
text output or a combination of those in your Markdown at build time
(square brackets indicate optional parameters):

- Source: `jnbsrc <tag> [relativePathToNotebook]`
- Source and text output (stdout): `jnbsrcout <tag> [relativePathToNotebook]`
- Text output (stdout): `jnbout <tag> [relativePathToNotebook]`
- Source and image output with alt text and optional caption: `jnbsrcimg <tag> <altText> [caption] [relativePathToNotebook]`
- Image output with alt text and optional caption: `jnbimg <tag> <altText> [caption] [relativePathToNotebook]`

## Options

The path to the notebook is relative to the document. The default path is
`notebook.ipynb`, but you can supply a different default path.

```js
eleventyConfig.addPlugin(jupyterPlugin, {
	defaultRelativePath: "notebook.ipynb"
});
```

## Supported Cell Types

Currently, only text and image content is supported. Adding more comes down
to defining the appropriate behavior. If you need support for something,
please open an issue with an example notebook.

### Sources

- code cell (independent of language)
- raw cell
- markdown cell

### Outputs

- Images: (`image/bmp`, `image/gif`, `image/jpeg`, `image/png`, `image/svg+xml`)
- Text output: stream to `stdout`/`stderr`, ``text/plain``, ``text/markdown``, ``text/html`` and ``application/json``

## Output

If source and output are included together (`jnbsrcout` and `jnbsrcimg`),
they are wrapped in a div with class `jnbcell`.
The div includes two other divs, one for the source with class `jnbsrc`,
one for the output with class `jnbout`. You can use those calsses to style
the cells using CSS.

## Internals

The plugin parses the `ipynb` file, which is just a JSON document. The
[Notebook file format](https://nbformat.readthedocs.io/en/latest/format_description.html)
defines the structure of the document.

The appropriate cells are selected based on the tag. Text is simply included
in the document (with fences for code). Images are written to a temporary
directory (`content/jnbgen`), which is deleted after the build.
The [Image plugin](https://www.11ty.dev/docs/plugins/image/) can then further
transform them like regular images.

A few more details can be found in [this blog post](https://valentinpratz.de/posts/2024-11-13-11ty-jupyter-integration/)

## Contributing

Up to now, the code is very basic, so feel free to modify it, open pull requests,
etc. If you have any questions, feel free to reach out.
